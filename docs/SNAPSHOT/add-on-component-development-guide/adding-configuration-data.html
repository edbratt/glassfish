
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Adding Configuration Data for a Component</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
<table id="doc-title" cellspacing="0" cellpadding="0">
  <tr>
  <td align="left" valign="top">
  <b>Adding Configuration Data for a Component</b><br />
      <p class="beta">DRAFT</p>
  </td>
  </tr>
</table>
<hr />

<table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>
		<td align="left">
		<a href="adding-monitoring-capabilities.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="adding-container-capabilities.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>


<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a id="GSACG00006"></a><a id="gjlpe"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-configuration-data-for-a-component">6 Adding Configuration Data for a Component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration data of a component determines the characteristics and
runtime behavior of a component. Eclipse GlassFish provides interfaces to
enable an add-on component to store its configuration data in the same
way as other GlassFish Server components. These interfaces are similar
to interfaces that are defined in
[Jakarta XML Binding](<code>https://jakarta.ee/specifications/xml-binding/</code>). By using these interfaces to
store configuration data, you ensure that the add-on component is fully
integrated with GlassFish Server. As a result, administrators can
configure an add-on component in the same way as they can configure
other GlassFish Server components.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#gjrdv">How GlassFish Server Stores Configuration Data</a></p>
</li>
<li>
<p><a href="#gjlop">Defining an Element</a></p>
</li>
<li>
<p><a href="#gjlpb">Defining an Attribute of an Element</a></p>
</li>
<li>
<p><a href="#gjlov">Defining a Subelement</a></p>
</li>
<li>
<p><a href="#gjlpu">Validating Configuration Data</a></p>
</li>
<li>
<p><a href="#gjrdj">Initializing a Component&#8217;s Configuration Data</a></p>
</li>
<li>
<p><a href="#gjrcz">Creating a Transaction to Update Configuration Data</a></p>
</li>
<li>
<p><a href="#gjmkt">Dotted Names and REST URLs of Configuration Attributes</a></p>
</li>
<li>
<p><a href="#gkaal">Examples of Adding Configuration Data for a Component</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="gjrdv"></a><a id="GSACG00121"></a><a id="how-glassfish-server-stores-configuration-data"></a></p>
</div>
<div class="sect2">
<h3 id="_how_glassfish_server_stores_configuration_data">How GlassFish Server Stores Configuration Data</h3>
<div class="paragraph">
<p>GlassFish Server stores the configuration data for a domain in a single
configuration file that is named <code>domain.xml</code>. This file is an
extensible markup language (XML) instance that contains a hierarchy of
elements to represent a domain&#8217;s configuration. The content model of
this XML instance is not defined in a document type definition (DTD) or
an XML schema. Instead, the content model is derived from Java language
interfaces with appropriate annotations. You use these annotations to
add configuration data for a component as explained in the sections that
follow.</p>
</div>
<div class="paragraph">
<p><a id="gjlop"></a><a id="GSACG00122"></a><a id="defining-an-element"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_an_element">Defining an Element</h3>
<div class="paragraph">
<p>An element represents an item of configuration data. For example, to
represent the configuration data for a network listener, GlassFish
Server defines the <code>network-listener</code> element.</p>
</div>
<div class="paragraph">
<p>Define an element for each item of configuration data that you are
adding.</p>
</div>
<div class="paragraph">
<p><a id="gjcnt"></a><a id="GSACG00074"></a><a id="to-define-an-element"></a></p>
</div>
<div class="sect3">
<h4 id="_to_define_an_element">To Define an Element</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define a Java language interface to represent the element.<br>
Define one interface for each element. Do not represent multiple
elements in a single interface.<br>
The name that you give to the interface determines name of the element
as follows:</p>
<div class="ulist">
<ul>
<li>
<p>A change from lowercase to uppercase in the interface name is
transformed to the hyphen (<code>-</code>) separator character.</p>
</li>
<li>
<p>The element name is all lowercase.<br>
For example, to define an interface to represent the
<code>wombat-container-config</code> element, give the name <code>WombatContainerConfig</code>
to the interface.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Specify the parent of the element.<br>
To specify the parent, extend the interface that identifies the parent
as shown in the following table.<br></p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parent Element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface to Extend</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.glassfish.api.admin.config.Container</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>applications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.glassfish.api.admin.config.ApplicationName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Another element that you are defining</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jvnet.hk2.config.ConfigBeanProxy</code></p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Annotate the declaration of the interface with the
<code>org.jvnet.hk2.config.Configured</code> annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GSACG00053"></a><a id="gjcne"></a></p>
</div>
<div class="paragraph">
<p>Example 6-1 Declaration of an Interface That Defines an Element</p>
</div>
<div class="paragraph">
<p>This example shows the declaration of the <code>WombatContainerConfig</code>
interface that represents the <code>wombat-container-config</code> element. The
parent of this element is the <code>config</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.jvnet.hk2.config.Configured;
...
import org.glassfish.api.admin.config.Container;
...
@Configured
public interface WombatContainerConfig extends Container {
...
}</code></pre>
</div>
</div>
<div id="sthref6" class="paragraph">
<p>How Interfaces That Are Annotated With @Configured Are Implemented</p>
</div>
<div class="paragraph">
<p>You are not required to implement any interfaces that you annotate with
the <code>@Configured</code> annotation. GlassFish Server implements these
interfaces by using the <code>Dom</code> class. GlassFish Server creates a Java
Platform, Standard Edition (Java SE) proxy for each <code>Dom</code> object to
implement the interface.</p>
</div>
<div class="paragraph">
<p><a id="gjlpb"></a><a id="GSACG00123"></a><a id="defining-an-attribute-of-an-element"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_an_attribute_of_an_element">Defining an Attribute of an Element</h3>
<div class="paragraph">
<p>The attributes of an element describe the characteristics of the
element. For example, the <code>port</code> attribute of the <code>network-listener</code>
element identifies the port number on which the listener listens.</p>
</div>
<div class="paragraph">
<p><a id="gjorj"></a><a id="GSACG00227"></a><a id="representing-an-attribute-of-an-element"></a></p>
</div>
<div class="sect3">
<h4 id="_representing_an_attribute_of_an_element">Representing an Attribute of an Element</h4>
<div class="paragraph">
<p>Represent each attribute of an element as the property of a pair of
JavaBeans specification getter and setter methods of the interface that
defines the element. The component for which the configuration data is
being defined can then access the attribute through the getter method.
The setter method enables the attribute to be updated.</p>
</div>
<div class="paragraph">
<p><a id="gjopa"></a><a id="GSACG00228"></a><a id="specifying-the-data-type-of-an-attribute"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_the_data_type_of_an_attribute">Specifying the Data Type of an Attribute</h4>
<div class="paragraph">
<p>The data type of an attribute is the return type of the getter method
that is associated with the attribute. To enable the attribute take
properties in the form <code>${`property-name</code>}` as values, specify the data
type as <code>String</code>.</p>
</div>
<div class="paragraph">
<p><a id="gjopm"></a><a id="GSACG00229"></a><a id="identifying-an-attribute-of-an-element"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_identifying_an_attribute_of_an_element">Identifying an Attribute of an Element</h4>
<div class="paragraph">
<p>To identify an attribute of an element, annotate the declaration of the
getter method that is associated with the attribute with the
<code>org.jvnet.hk2.config.Attribute</code> annotation.</p>
</div>
<div class="paragraph">
<p>To specify the properties of the attribute, use the elements of the
<code>@Attribute</code> annotation as explained in the sections that follow.</p>
</div>
<div class="paragraph">
<p><a id="gjopq"></a><a id="GSACG00230"></a><a id="specifying-the-name-of-an-attribute"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_the_name_of_an_attribute">Specifying the Name of an Attribute</h4>
<div class="paragraph">
<p>To specify the name of an attribute, set the <code>value</code> element of the
<code>@Attribute</code> annotation to a string that specifies the name. If you do
not set this element, the name is derived from the name of the property
as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A change from lowercase to uppercase in the interface name is
transformed to the hyphen (<code>-</code>) separator character.</p>
</li>
<li>
<p>The element name is all lowercase.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if the getter method <code>getNumberOfInstances</code> is defined for
the property <code>NumberOfInstances</code> to represent an attribute, the name of
the attribute is <code>number-of-instances</code>.</p>
</div>
<div class="paragraph">
<p><a id="gjoqj"></a><a id="GSACG00231"></a><a id="specifying-the-default-value-of-an-attribute"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_the_default_value_of_an_attribute">Specifying the Default Value of an Attribute</h4>
<div class="paragraph">
<p>The default value of an attribute is the value that is applied if the
attribute is omitted when the element is written to the domain
configuration file.</p>
</div>
<div class="paragraph">
<p>To specify the default value of an attribute, set the <code>defaultValue</code>
element of the <code>@Attribute</code> annotation to a string that contains the
default value. If you do not set this element, the parameter has no
default value.</p>
</div>
<div class="paragraph">
<p><a id="gjoui"></a><a id="GSACG00232"></a><a id="specifying-whether-an-attribute-is-required-or-optional"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_specifying_whether_an_attribute_is_required_or_optional">Specifying Whether an Attribute Is Required or Optional</h4>
<div class="paragraph">
<p>Whether an attribute is required or optional determines how GlassFish
Server responds if the parameter is omitted when the element is written
to the domain configuration file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the attribute is required, an error occurs.</p>
</li>
<li>
<p>If the attribute is optional, the element is written successfully to
the domain configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To specify whether an attribute is required or optional, set the
<code>required</code> element of the <code>@Attribute</code> annotation as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the attribute is required, set the <code>required</code> element to <code>true</code>.</p>
</li>
<li>
<p>If the attribute is optional, set the <code>required</code> element to <code>false</code>.
This value is the default.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="gjrdz"></a><a id="GSACG00233"></a><a id="example-of-defining-an-attribute-of-an-element"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_example_of_defining_an_attribute_of_an_element">Example of Defining an Attribute of an Element</h4>
<div id="sthref7" class="paragraph">
<p>Example 6-2 Defining an Attribute of an Element</p>
</div>
<div class="paragraph">
<p>This example defines the attribute <code>number-of-instances</code>. To enable the
attribute take properties in the form <code>${`property-name</code>}` as values,
the data type of this attribute is <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.jvnet.hk2.config.Attribute;
...
    @Attribute
    public String getNumberOfInstances();
    public void setNumberOfInstances(String instances) throws PropertyVetoException;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gjlov"></a><a id="GSACG00124"></a><a id="defining-a-subelement"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_a_subelement">Defining a Subelement</h3>
<div class="paragraph">
<p>A subelement represents a containment or ownership relationship. For
example, GlassFish Server defines the <code>network-listeners</code> element to
contain the configuration data for individual network listeners. The
configuration data for an individual network listener is represented by
the <code>network-listener</code> element, which is a subelement of
<code>network-listeners</code> element.</p>
</div>
<div class="paragraph">
<p><a id="gjzlb"></a><a id="GSACG00075"></a><a id="to-define-a-subelement"></a></p>
</div>
<div class="sect3">
<h4 id="_to_define_a_subelement">To Define a Subelement</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define an interface to represent the subelement.<br>
For more information, see <a href="#gjlop">Defining an Element</a>.<br>
The interface that represents the subelement must extend the
<code>org.jvnet.hk2.config.ConfigBeanProxy</code> interface.</p>
</li>
<li>
<p>In the interface that defines the parent element, identify the
subelement to its parent element.</p>
</li>
<li>
<p>Represent the subelement as the property of a JavaBeans
specification getter or setter method.</p>
</li>
<li>
<p>Annotate the declaration of the getter or setter method that is
associated with the subelement with the <code>org.jvnet.hk2.config.Element</code>
annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GSACG00054"></a><a id="gjzjt"></a></p>
</div>
<div class="paragraph">
<p>Example 6-3 Declaring an Interface to Represent a Subelement</p>
</div>
<div class="paragraph">
<p>This example shows the declaration of the <code>WombatElement</code> interface to
represent the <code>wombat-element</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.jvnet.hk2.config.ConfigBeanProxy;
import org.jvnet.hk2.config.Configured;
...
@Configured
public interface WombatElement extends ConfigBeanProxy {
...
}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00055"></a><a id="gjzkh"></a></p>
</div>
<div class="paragraph">
<p>Example 6-4 Identifying a Subelement to its Parent Element</p>
</div>
<div class="paragraph">
<p>This example identifies the <code>wombat-element</code> element as a subelement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.jvnet.hk2.config.Element;
...
import java.beans.PropertyVetoException;
...
@Element
    public WombatElement getElement();
    public void setElement(WombatElement element) throws PropertyVetoException;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gjlpu"></a><a id="GSACG00125"></a><a id="validating-configuration-data"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validating_configuration_data">Validating Configuration Data</h3>
<div class="paragraph">
<p>Validating configuration data ensures that attribute values that are
being set or updated do not violate any constraints that you impose on
the data. For example, you might require that an attribute that
represents a name is not null, or an integer that represents a port
number is within the range of available port numbers. Any attempt to set
or update an attribute value that fails validation fails. Any
validations that you specify for an attribute are performed when the
attribute is initialized and every time the attribute is changed.</p>
</div>
<div class="paragraph">
<p>To standardize the validation of configuration data, GlassFish Server
uses <a href="https://jakarta.ee/specifications/bean-validation/">Jakarta Bean Validation</a>
(<code>https://jakarta.ee/specifications/bean-validation/</code>) for validating configuration
data. Jakarta Bean Validation defines a metadata model and API for the validation of
JavaBeans components.</p>
</div>
<div class="paragraph">
<p>To validate an attribute of an element, annotate the attribute&#8217;s getter
method with the annotation in the <code>jakarta.validation.constraints</code> package
that performs the validation that you require. The following table lists
commonly used annotations for validating GlassFish Server configuration
data. For the complete list of annotations, see the
<a href="https://jakarta.ee/specifications/bean-validation/3.0/apidocs/jakarta/validation/constraints/package-summary.html"><code>jakarta.validation.constraints</code>
package summary</a>
(<code>https://jakarta.ee/specifications/bean-validation/3.0/apidocs/jakarta/validation/constraints/package-summary.html</code>).</p>
</div>
<div class="paragraph">
<p><a id="sthref8"></a><a id="gjrlg"></a></p>
</div>
<div class="paragraph">
<p>Table 6-1 Commonly Used Annotations for Validating GlassFish Server
Configuration Data</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 37%;">
<col style="width: 63%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Validation</th>
<th class="tableblock halign-left valign-top">Annotation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.validation.constraints.NotNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.validation.constraints.Null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>jakarta.validation.constraints.Min</code></p>
</div>
<div class="paragraph">
<p>Set the <code>value</code> element of this annotation to the minimum allowed value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>jakarta.validation.constraints.Max</code></p>
</div>
<div class="paragraph">
<p>Set the <code>value</code> element of this annotation to the maximum allowed value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular expression matching</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>jakarta.validation.constraints.Pattern</code></p>
</div>
<div class="paragraph">
<p>Set the <code>regexp</code> element of this annotation to the regular expression
that is to be matched.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="GSACG00056"></a><a id="gjrmp"></a></p>
</div>
<div class="paragraph">
<p>Example 6-5 Specifying a Range of Valid Values for an Integer</p>
</div>
<div class="paragraph">
<p>This example specifies that the attribute <code>rotation-interval-in-minutes</code>
must be a positive integer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import jakarta.validation.constraints.Max;
import jakarta.validation.constraints.Min;
...
@Min(value=1)
@Max(value=Integer.MAX_VALUE)
String getRotationIntervalInMinutes();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00057"></a><a id="gjzkq"></a></p>
</div>
<div class="paragraph">
<p>Example 6-6 Specifying Regular Expression Matching</p>
</div>
<div class="paragraph">
<p>This example specifies that the attribute <code>classname</code> must contain only
non-whitespace characters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import jakarta.validation.constraints.Pattern;
...
@Pattern(regexp="^[\\S]*$")
String getClassname();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gjrdj"></a><a id="GSACG00126"></a><a id="initializing-a-components-configuration-data"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_initializing_a_component_s_configuration_data">Initializing a Component&#8217;s Configuration Data</h3>
<div class="paragraph">
<p>To ensure that a component&#8217;s configuration data is added to the
<code>domain.xml</code> file when the component is first instantiated, you must
initialize the component&#8217;s configuration data.</p>
</div>
<div class="paragraph">
<p>Initializing a component&#8217;s configuration data involves the following
tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#gkbgi">To Define a Component&#8217;s Initial Configuration Data</a></p>
</li>
<li>
<p><a href="#gjses">To Write a Component&#8217;s Initial Configuration Data to the
<code>domain.xml</code> File</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="gkbgi"></a><a id="GSACG00076"></a><a id="to-define-a-components-initial-configuration-data"></a></p>
</div>
<div class="sect3">
<h4 id="_to_define_a_component_s_initial_configuration_data">To Define a Component&#8217;s Initial Configuration Data</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a plain-text file that contains an XML fragment to represent
the configuration data.</p>
<div class="ulist">
<ul>
<li>
<p>Ensure that each XML element accurately represents the interface that
is defined for the element.</p>
</li>
<li>
<p>Ensure that any subelements that you are initializing are correctly
nested.</p>
</li>
<li>
<p>Set attributes of the elements to their required initial values.</p>
</li>
</ul>
</div>
</li>
<li>
<p>When you package the component, include the file that contains the
XML fragment in the component&#8217;s JAR file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GSACG00058"></a><a id="gkaba"></a></p>
</div>
<div class="paragraph">
<p>Example 6-7 XML Data Fragment</p>
</div>
<div class="paragraph">
<p>This example shows the XML data fragment for adding the
<code>wombat-container-config</code> element to the <code>domain.xml</code> file. The
<code>wombat-container-config</code> element contains the subelement
<code>wombat-element</code>. The attributes of <code>wombat-element</code> are initialized as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>foo</code> attribute is set to <code>something</code>.</p>
</li>
<li>
<p>The <code>bar</code> attribute is set to <code>anything</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;wombat-container-config&gt;
    &lt;wombat-element foo="something" bar="anything"/&gt;
&lt;/wombat-container-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gjses"></a><a id="GSACG00077"></a><a id="to-write-a-components-initial-configuration-data-to-the-domain.xml-file"></a></p>
</div>
<div class="paragraph">
<p>To Write a Component&#8217;s Initial Configuration Data to the <code>domain.xml</code>
File
<sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup>^^</p>
</div>
<div class="paragraph">
<p>Add code to write the component&#8217;s initial configuration data in the
class that represents your add-on component. If your add-on component is
a container, add this code to the sniffer class. For more information
about adding a container, see
<a href="adding-container-capabilities.html#ghmon">Adding Container
Capabilities</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set an optional dependency on an instance of the class that
represents the XML element that you are adding.</p>
</li>
<li>
<p>Initialize the instance variable to <code>null</code>.<br>
If the element is not present in the <code>domain.xml</code> file when the add-on
component is initialized, the instance variable remains <code>null</code>.</p>
</li>
<li>
<p>Annotate the declaration of the instance variable with the
<code>org.jvnet.hk2.annotations.Inject</code> annotation.</p>
</li>
<li>
<p>Set the <code>optional</code> element of the <code>@Inject</code> annotation to <code>true</code>.</p>
</li>
<li>
<p>Set a dependency on an instance of the following classes:</p>
<div class="ulist">
<ul>
<li>
<p><code>org.glassfish.api.admin.config.ConfigParser</code><br>
The <code>ConfigParser</code> class provides methods to parse an XML fragment and
to write the fragment to the correct location in the <code>domain.xml</code> file.</p>
</li>
<li>
<p><code>org.jvnet.hk2.component.Habitat</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Invoke the <code>parseContainerConfig</code> method of the <code>ConfigParser</code>
object only if the instance is <code>null</code>.<br>
If your add-on component is a container, invoke this method within the
implementation of the <code>setup</code> method the sniffer class. When the
container is first instantiated, GlassFish Server invokes the <code>setup</code>
method.<br>
The test that the instance is <code>null</code> is required to ensure that the
configuration data is added only if the data is not already present in
the <code>domain.xml</code> file.<br>
In the invocation of the <code>parseContainerConfig</code> method, pass the
following items as parameters:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>Habitat</code> object on which you set a dependency</p>
</li>
<li>
<p>The URL to the file that contains the XML fragment that represents the
configuration data</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="GSACG00059"></a><a id="gkabo"></a></p>
</div>
<div class="paragraph">
<p>Example 6-8 Writing a Component&#8217;s Initial Configuration Data to the
<code>domain.xml</code> File</p>
</div>
<div class="paragraph">
<p>This example writes the XML fragment in the file <code>init.xml</code> to the
<code>domain.xml</code> file. The fragment is written only if the <code>domain.xml</code> file
does not contain the <code>wombat-container-config-element</code>.</p>
</div>
<div class="paragraph">
<p>The <code>wombat-container-config</code> element is represented by the
<code>WombatContainerConfig</code> interface. An optional dependency is set on an
instance of a class that implements <code>WombatContainerConfig</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.glassfish.api.admin.config.ConfigParser;
import org.glassfish.examples.extension.config.WombatContainerConfig;
...
import org.jvnet.hk2.annotations.Inject;
import org.jvnet.hk2.component.Habitat;
import com.sun.enterprise.module.Module;

import java.util.logging.Logger;
...
import java.io.IOException;
import java.lang.annotation.Annotation;
import java.lang.reflect.Array;
import java.net.URL;
...
    @Inject(optional=true)
    WombatContainerConfig config=null;
...
@Inject
    ConfigParser configParser;

    @Inject
    Habitat habitat;

    public Module[] setup(String containerHome, Logger logger) throws IOException {
        if (config==null) {
            URL url = this.getClass().getClassLoader().getResource("init.xml");
            if (url!=null) {
               configParser.parseContainerConfig(habitat, url,
                   WombatContainerConfig.class);
            }
        }
        return null;
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00060"></a><a id="gjski"></a></p>
</div>
<div class="paragraph">
<p>Example 6-9 <code>domain.xml</code> File After Initialization</p>
</div>
<div class="paragraph">
<p>This example shows the <code>domain.xml</code> file after the <code>setup</code> method was
invoked to add the <code>wombat-container-config</code> element under the <code>config</code>
element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;domain...&gt;
...
   &lt;configs&gt;
    &lt;config name="server-config"&gt;
      &lt;wombat-container-config number-of-instances="5"&gt;
        &lt;wombat-element foo="something" bar="anything" /&gt;
      &lt;/wombat-container-config&gt;
      &lt;http-service&gt;
...
&lt;/domain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gjrcz"></a><a id="GSACG00127"></a><a id="creating-a-transaction-to-update-configuration-data"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_transaction_to_update_configuration_data">Creating a Transaction to Update Configuration Data</h3>
<div class="paragraph">
<p>Creating a transaction to update configuration data enables the data to
be updated without the need to specify a dotted name in the
<a href="../reference-manual/set.html#GSRFM00226"><code>set</code></a> subcommand. You can make the transaction
available to system administrators in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By adding an <a href="../reference-manual/asadmin.html#GSRFM00263"><code>asadmin</code></a> subcommand. If you are adding
an <code>asadmin</code> subcommand, include the code for the transaction in the
body of the subcommand&#8217;s <code>execute</code> method. For more information, see
<a href="extending-asadmin.html#ghmrd">Extending the <code>asadmin</code> Utility</a>.</p>
</li>
<li>
<p>By extending the Administration Console. For more information, see
<a href="extending-the-admin-console.html#ghmrb">Extending the Administration
Console</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="gkakw"></a><a id="GSACG00078"></a><a id="to-create-a-transaction-to-update-configuration-data"></a></p>
</div>
<div class="sect3">
<h4 id="_to_create_a_transaction_to_update_configuration_data">To Create a Transaction to Update Configuration Data</h4>
<div class="paragraph">
<p>Any transaction that you create to modify configuration data must use a
configuration change transaction to ensure that the change is atomic,
consistent, isolated, and durable (ACID).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="gkakq"></a>
Set a dependency on the configuration object to update.</p>
</li>
<li>
<p><a id="gkalq"></a>
Define a method to invoke to perform the transaction.</p>
</li>
<li>
<p>Use the generic <code>SimpleConfigCode</code> interface to define the method
that is to be invoked on a single configuration object, namely:
<code>SingleConfigCode&lt;T extends ConfigBeanProxy&gt;()</code>.</p>
</li>
<li>
<p>In the body of this method, implement the <code>run</code> method of the
<code>SingleConfigCode&lt;T extends ConfigBeanProxy&gt;</code> interface.</p>
</li>
<li>
<p>In the body of the <code>run</code> method, invoke the setter methods that are
defined for the attributes that you are setting.<br>
These setter methods are defined in the interface that represents the
element whose elements you are setting.</p>
</li>
<li>
<p>Invoke the static method
<code>org.jvnet.hk2.config.ConfigSupport.ConfigSupport.apply</code>.<br>
In the invocation, pass the following information as parameters to the
method:</p>
<div class="ulist">
<ul>
<li>
<p>The code of the method that you defined in Step  <a href="#gkalq">2</a>.</p>
</li>
<li>
<p>The configuration object to update, on which you set the dependency in
Step <a href="#gkakq">1</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="sthref9" class="paragraph">
<p>Example 6-10 Creating a Transaction to Update Configuration Data</p>
</div>
<div class="paragraph">
<p>This example shows code in the <code>execute</code> method of an <code>asadmin</code>
subcommand for updating the <code>number-of-instances</code> element of
<code>wombat-container-config</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.glassfish.api.Param;
...
import org.jvnet.hk2.annotations.Inject;
import org.jvnet.hk2.config.Transactions;
import org.jvnet.hk2.config.ConfigSupport;
import org.jvnet.hk2.config.SingleConfigCode;
import org.jvnet.hk2.config.TransactionFailure;
...
    @Param
    String instances;

    @Inject
    WombatContainerConfig config;

    public void execute(AdminCommandContext adminCommandContext) {
        try {
            ConfigSupport.apply(new SingleConfigCode&lt;WombatContainerConfig&gt;() {
                public Object run(WombatContainerConfig wombatContainerConfig)
                        throws PropertyVetoException, TransactionFailure {
                    wombatContainerConfig.setNumberOfInstances(instances);
                    return null;
                }
            }, config);
        } catch(TransactionFailure e) {
        }
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gjmkt"></a><a id="GSACG00128"></a><a id="dotted-names-and-rest-urls-of-configuration-attributes"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dotted_names_and_rest_urls_of_configuration_attributes">Dotted Names and REST URLs of Configuration Attributes</h3>
<div class="paragraph">
<p>The GlassFish Server administrative subcommands <a href="../reference-manual/get.html#GSRFM00139"><code>get</code></a>,
<a href="../reference-manual/list.html#GSRFM00145"><code>list</code></a>, and o<a href="GSRFM00226"><code>set</code></a> locate a
configuration attribute through the dotted name of the attribute. The
dotted name of an attribute of a configuration element is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">configs.config.server-config.element-name[.subelement-name...].attribute-name</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">element-name</dt>
<dd>
<p>The name of an element that contains a subelement or the attribute.</p>
</dd>
<dt class="hdlist1">subelement-name</dt>
<dd>
<p>The name of a subelement, if any.</p>
</dd>
<dt class="hdlist1">attribute-name</dt>
<dd>
<p>The name of the attribute.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the dotted name of the <code>foo</code> attribute of the
<code>wombat-element</code> element is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">configs.config.server-config.wombat-container-config.wombat-element.foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The formats of the URL to a REST resource that represent an attribute of
a configuration element is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">http://host:port/management/domain/path</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">host</dt>
<dd>
<p>The host where the DAS is running.</p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>The HTTP port or HTTPS port for administration.</p>
</dd>
<dt class="hdlist1">path</dt>
<dd>
<p>The path to the attribute. The path is the dotted name of the
attribute in which each dot (<code>.</code>) is replaced with a slash (<code>/</code>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the URL to the REST resource for the <code>foo</code> attribute of the
<code>wombat-element</code> element is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">http://localhost:4848/management/domain/configs/config/server-config/
wombat-container-config/wombat-element/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the DAS is running on the local host and the HTTP port
for administration is 4848.</p>
</div>
<div class="paragraph">
<p><a id="gkaal"></a><a id="GSACG00131"></a><a id="examples-of-adding-configuration-data-for-a-component"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_of_adding_configuration_data_for_a_component">Examples of Adding Configuration Data for a Component</h3>
<div class="paragraph">
<p>This example shows the interfaces that define the configuration data for
the Greeter Container component. The data is comprised of the following
elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A parent element, which is shown in <a href="#gkamy">Example 6-11</a></p>
</li>
<li>
<p>A subelement that is contained by the parent element, which is shown
in <a href="#gkamb">Example 6-12</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example also shows an XML data fragment for initializing an
element. See <a href="#gkamk">Example 6-13</a>.</p>
</div>
<div class="paragraph">
<p>Code for the Greeter Container component is shown in
<a href="adding-container-capabilities.html#gkane">Example of Adding Container
Capabilities</a>.</p>
</div>
<div class="paragraph">
<p>Code for an <code>asadmin</code> subcommand that updates the configuration data in
this example is shown in <a href="extending-asadmin.html#gkbdf">Example 4-7</a>.</p>
</div>
<div class="paragraph">
<p><a id="GSACG00061"></a><a id="gkamy"></a></p>
</div>
<div class="paragraph">
<p>Example 6-11 Parent Element Definition</p>
</div>
<div class="paragraph">
<p>This example shows the definition of the <code>greeter-container-config</code>
element. The attributes of the <code>greeter-container-config</code> element are as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>number-of-instances</code>, which must be in the range 1-10.</p>
</li>
<li>
<p><code>language</code>, which must contain only non-whitespace characters.</p>
</li>
<li>
<p><code>style</code>, which must contain only non-whitespace characters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>greeter-element</code> element is identified as a subelement of the
<code>greeter-container-config</code> element. The definition of the
<code>greeter-element</code> element is shown in <a href="#gkamb">Example 6-12</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.glassfish.examples.extension.greeter.config;

import org.jvnet.hk2.config.Configured;
import org.jvnet.hk2.config.Attribute;
import org.jvnet.hk2.config.Element;
import org.glassfish.api.admin.config.Container;

import jakarta.validation.constraints.Pattern;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.Max;

import java.beans.PropertyVetoException;

@Configured
public interface GreeterContainerConfig extends Container {

    @Attribute
    @Min(value=1)
    @Max (value=10)
    public String getNumberOfInstances();
    public void setNumberOfInstances(String instances) throws PropertyVetoException;

    @Attribute
    @Pattern(regexp = "^[\\S]*$")
    public String getLanguage();
    public void setLanguage(String language) throws PropertyVetoException;

    @Attribute
    @Pattern(regexp = "^[\\S]*$")
    public String getStyle();
    public void setStyle(String style) throws PropertyVetoException;

    @Element
    public GreeterElement getElement();
    public void setElement(GreeterElement element) throws PropertyVetoException;


}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00062"></a><a id="gkamb"></a></p>
</div>
<div class="paragraph">
<p>Example 6-12 Subelement Definition</p>
</div>
<div class="paragraph">
<p>This example shows the definition of the <code>greeter-element</code> element,
which is identified as a subelement of the <code>greeter-container-config</code>
element in <a href="#gkamy">Example 6-11</a>. The only attribute of the
<code>greeter-element</code> element is <code>greeter-port</code>, which must be in the range
1030-1050.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.glassfish.examples.extension.greeter.config;

import org.jvnet.hk2.config.ConfigBeanProxy;
import org.jvnet.hk2.config.Configured;
import org.jvnet.hk2.config.Attribute;

import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.Max;

import java.beans.PropertyVetoException;

@Configured
public interface GreeterElement extends ConfigBeanProxy {

    @Attribute
    @Min(value=1030)
    @Max (value=1050)
    public String getGreeterPort();
    public void setGreeterPort(String greeterport) throws PropertyVetoException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00063"></a><a id="gkamk"></a></p>
</div>
<div class="paragraph">
<p>Example 6-13 XML Data Fragment for Initializing the
<code>greeter-container-config</code> Element</p>
</div>
<div class="paragraph">
<p>This example shows the XML data fragment for adding the
<code>greeter-container-config</code> element to the <code>domain.xml</code> file. The
<code>greeter-container-config</code> element contains the subelement
<code>greeter-element</code>.</p>
</div>
<div class="paragraph">
<p>The attributes of <code>greeter-container-config</code> are initialized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>number-of-instances</code> attribute is set to <code>5</code>.</p>
</li>
<li>
<p>The <code>language</code> attribute is set to <code>norsk</code>.</p>
</li>
<li>
<p>The <code>style</code> element is set to <code>formal</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>greeter-port</code> attribute of the <code>greeter-element</code> element is set to
<code>1040</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;greeter-container-config number-of-instances="5" language="norsk" style="formal"&gt;
    &lt;greeter-element greeter-port="1040"/&gt;
&lt;/greeter-container-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The definition of the <code>greeter-container-config</code> element is shown in
<a href="#gkamy">Example 6-11</a>. The definition of the <code>greeter-element</code>
element is shown in <a href="#gkamb">Example 6-12</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre></pre>
</div>
</div>
</div>
</div>
</div>

<hr />

<table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>		
		<td align="left">
		<a href="adding-monitoring-capabilities.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="adding-container-capabilities.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>

<span id="copyright">
        <img src="img/eclipse_foundation_logo_tiny.png" height="20px" alt="Eclipse Foundation Logo" align="top"/>&nbsp;            
        <span >Copyright&nbsp;&copy;&nbsp;2020,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.</span>
</span>

<p align="center" class="beta">DRAFT</p>

</body>
</html>