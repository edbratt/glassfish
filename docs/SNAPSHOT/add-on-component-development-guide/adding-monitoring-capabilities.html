
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Adding Monitoring Capabilities</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
<table id="doc-title" cellspacing="0" cellpadding="0">
  <tr>
  <td align="left" valign="top">
  <b>Adding Monitoring Capabilities</b><br />
      <p class="beta">DRAFT</p>
  </td>
  </tr>
</table>
<hr />

<table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>
		<td align="left">
		<a href="extending-asadmin.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="adding-configuration-data.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>


<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a id="GSACG00005"></a><a id="ghmos"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-monitoring-capabilities">5 Adding Monitoring Capabilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Monitoring is the process of reviewing the statistics of a system to
improve performance or solve problems. By monitoring the state of
components and services that are deployed in the GlassFish Server,
system administrators can identify performance bottlenecks, predict
failures, perform root cause analysis, and ensure that everything is
functioning as expected. Monitoring data can also be useful in
performance tuning and capacity planning.</p>
</div>
<div class="paragraph">
<p>An add-on component typically generates statistics that the Eclipse GlassFish
Server can gather at run time. Adding monitoring capabilities enables an
add-on component to provide statistics to GlassFish Server in the same
way as components that are supplied in GlassFish Server distributions.
As a result, system administrators can use the same administrative
interfaces to monitor statistics from any installed GlassFish Server
component, regardless of the origin of the component.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ghopc">Defining Statistics That Are to Be Monitored</a></p>
</li>
<li>
<p><a href="#ghplw">Updating the Monitorable Object Tree</a></p>
</li>
<li>
<p><a href="#ghrma">Dotted Names and REST URLs for an Add-On Component&#8217;s
Statistics</a></p>
</li>
<li>
<p><a href="#ghptj">Example of Adding Monitoring Capabilities</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="ghopc"></a><a id="GSACG00116"></a><a id="defining-statistics-that-are-to-be-monitored"></a></p>
</div>
<div class="sect2">
<h3 id="_defining_statistics_that_are_to_be_monitored">Defining Statistics That Are to Be Monitored</h3>
<div class="paragraph">
<p>At runtime, your add-on component might perform operations that affect
the behavior and performance of your system. For example, your component
might start a thread of control, receive a request from a service, or
request a connection from a connection pool. Monitoring the statistics
that are related to these operations helps a system administrator
maintain the system.</p>
</div>
<div class="paragraph">
<p>To provide statistics to GlassFish Server, your component must define
events for the operations that generate these statistics. At runtime,
your component must send these events when performing the operations for
which the events are defined. For example, to enable the number of
received requests to be monitored, a component must send a "request
received" event each time that the component receives a request.</p>
</div>
<div class="paragraph">
<p>A statistic can correspond to single event or to multiple events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Counter statistics typically correspond to a single event. For
example, to calculate the number of received requests, only one event is
required, for example, a "request received" event. Every time that a
"request received" event is sent, the number of received requests is
increased by 1.</p>
</li>
<li>
<p>Timer statistics typically correspond to multiple events. For example,
to calculate the time to process a request, two requests, for example, a
"request received" event and a "request completed" event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Defining statistics that are to be monitored involves the following
tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#gkadk">Defining an Event Provider</a></p>
</li>
<li>
<p><a href="#ghprg">Sending an Event</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="gkadk"></a><a id="GSACG00220"></a><a id="defining-an-event-provider"></a></p>
</div>
<div class="sect3">
<h4 id="_defining_an_event_provider">Defining an Event Provider</h4>
<div class="paragraph">
<p>An event provider defines the types of events for the operations that
generate statistics for an add-on component.</p>
</div>
<div class="paragraph">
<p>GlassFish Server enables you to define an event provider in the
following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By writing a Java Class. Define an event provider this way if you have
access to the source code of the component for which you are defining an
event provider.</p>
</li>
<li>
<p>By writing an XML fragment. Define an event provider this way if you
do not have access to the source code of the component for which you are
defining and event provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="ghovq"></a><a id="GSACG00164"></a><a id="defining-an-event-provider-by-writing-a-java-class"></a></p>
</div>
<div class="sect4">
<h5 id="_defining_an_event_provider_by_writing_a_java_class">Defining an Event Provider by Writing a Java Class</h5>
<div class="paragraph">
<p>To define an event provider, write a Java language class that defines
the types of events for the component. Your class is not required to
extend any specific class or implement any interfaces.</p>
</div>
<div class="paragraph">
<p>To identify your class as an event provider, annotate the declaration of
the class with the
<code>org.glassfish.external.probe.provider.annotations.ProbeProvider</code>
annotation.</p>
</div>
<div class="paragraph">
<p>To create a name space for event providers and to uniquely identify an
event provider to the monitoring infrastructure of GlassFish Server, set
the elements of the <code>@ProbeProvider</code> annotation as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>moduleProviderName</code></dt>
<dd>
<p>Your choice of text to identify the application to which the event
provider belongs. The value of the <code>moduleProviderName</code> element is not
required to be unique.<br>
For example, for event providers from GlassFish Server Open Source
Edition, <code>moduleProviderName</code> is <code>glassfish</code>.</p>
</dd>
<dt class="hdlist1"><code>moduleName</code></dt>
<dd>
<p>Your choice of name for the module for which the event provider is
defined. A module provides significant functionality of an
application. The value of the <code>moduleName</code> element is not required to
be unique.<br>
In GlassFish Server, examples of module names are <code>web-container</code>,
<code>ejb-container</code>, <code>transaction</code>, and <code>webservices</code>.</p>
</dd>
<dt class="hdlist1"><code>probeProviderName</code></dt>
<dd>
<p>Your choice of name to identify the event provider. To uniquely
identify the event provider, ensure that <code>probeProviderName</code> is unique
for all event providers in the same module.<br>
In GlassFish Server, examples of eventâ€”provider names are <code>jsp</code>,
<code>servlet</code>, and <code>web-module</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a id="ghosi"></a><a id="GSACG00011"></a><a id="defining-event-types-in-an-event-provider-class"></a></p>
</div>
<div class="paragraph">
<p>Defining Event Types in an Event Provider Class</p>
</div>
<div class="paragraph">
<p>To define event types in an event provider class, write one method for
each type of event that is related to the component. The requirements
for each method are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The return value of the callback methods must be void.</p>
</li>
<li>
<p>The method body must be empty. You instantiate the event provider
class in the class that invokes the method to send the event. For more
information, see <a href="#ghprg">Sending an Event</a>.</p>
</li>
<li>
<p>To enable the event to be used as an Oracle Solaris DTrace probe, each
parameter in the method signature must be a Java language primitive,
such as <code>Integer</code>, <code>boolean</code>, or <code>String</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Annotate the declaration of each method with the
<code>org.glassfish.external.probe.provider.annotations.Probe</code> annotation.</p>
</div>
<div class="paragraph">
<p>By default, the type of the event is the method name. If you overload a
method in your class, you must uniquely identify the event type for each
form of the method. To uniquely identify the event type, set the <code>name</code>
element of the <code>@Probe</code> annotation to the name of the event type.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>You are not required to uniquely identify the event type for methods
that are not overloaded.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="ghoul"></a><a id="GSACG00012"></a><a id="specifying-event-parameters"></a></p>
</div>
<div class="paragraph">
<p>Specifying Event Parameters</p>
</div>
<div class="paragraph">
<p>To enable methods in an event listener to select a subset of values,
annotate each parameter in the method signature with the
<code>org.glassfish.external.probe.provider.annotations.ProbeParam</code>
annotation. Set the <code>value</code> element of the <code>@ProbeParam</code> annotation to
the name of the parameter.</p>
</div>
<div class="paragraph">
<p><a id="ghpmm"></a><a id="GSACG00013"></a><a id="example-of-defining-an-event-provider-by-writing-a-java-class"></a></p>
</div>
<div class="paragraph">
<p>Example of Defining an Event Provider by Writing a Java Class</p>
</div>
<div class="paragraph">
<p><a id="GSACG00041"></a><a id="ghprw"></a></p>
</div>
<div class="paragraph">
<p>Example 5-1 Defining an Event Provider by Writing a Java Class</p>
</div>
<div class="paragraph">
<p>This example shows the definition of the <code>TxManager</code> class. This class
defines events for the start and end of transactions that are performed
by a transaction manager.</p>
</div>
<div class="paragraph">
<p>The methods in this class are as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>onTxBegin</code></dt>
<dd>
<p>This method sends an event to indicate the start of a transaction. The
name of the event type that is associated with this method is <code>begin</code>.
A parameter that is named <code>txId</code> is passed to the method.</p>
</dd>
<dt class="hdlist1"><code>onCompletion</code></dt>
<dd>
<p>This method sends an event to indicate the end of a transaction. The
name of the event type that is associated with this method is <code>end</code>. A
parameter that is named <code>outcome</code> is passed to the method.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.glassfish.external.probe.provider.annotations.Probe;
import org.glassfish.external.probe.provider.annotations.ProbeParam;
import org.glassfish.external.probe.provider.annotations.ProbeProvider;
@ProbeProvider(moduleProviderName="examplecomponent",
moduleName="transaction", probeProviderName="manager")
public class TxManager {

    @Probe("begin")
    public void onTxBegin(
        @ProbeParam("{txId}") String txId
    ){}

    @Probe ("end")
    public void onCompletion(
        @ProbeParam("{outcome}") boolean outcome
    ){}
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gkaec"></a><a id="GSACG00165"></a><a id="defining-an-event-provider-by-writing-an-xml-fragment"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_defining_an_event_provider_by_writing_an_xml_fragment">Defining an Event Provider by Writing an XML Fragment</h5>
<div class="paragraph">
<p>To define an event provider, write an extensible markup language (XML)
fragment that contains a single <code>probe-provider</code> element.</p>
</div>
<div class="paragraph">
<p>To create a name space for event providers and to uniquely identify an
event provider to the monitoring infrastructure of GlassFish Server, set
the attributes of the <code>probe-provider</code> element as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>moduleProviderName</code></dt>
<dd>
<p>Your choice of text to identify the application to which the event
provider belongs. The value of the <code>moduleProviderName</code> attribute is
not required to be unique.<br>
For example, for event providers from GlassFish Server Open Source
Edition, <code>moduleProviderName</code> is <code>glassfish</code>.</p>
</dd>
<dt class="hdlist1"><code>moduleName</code></dt>
<dd>
<p>Your choice of name for the module for which the event provider is
defined. A module provides significant functionality of an
application. The value of the <code>moduleName</code> attribute is not required
to be unique.<br>
In GlassFish Server, examples of module names are <code>web-container</code>,
<code>ejb-container</code>, <code>transaction</code>, and <code>webservices</code>.</p>
</dd>
<dt class="hdlist1"><code>probeProviderName</code></dt>
<dd>
<p>Your choice of name to identify the event provider. To uniquely
identify the event provider, ensure that <code>probeProviderName</code> is unique
for all event providers in the same module.<br>
In GlassFish Server, examples of eventâ€”provider names are <code>jsp</code>,
<code>servlet</code>, and <code>web-module</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Within the <code>probe-provider</code> element, add one <code>probe</code> element for each
event type that you are defining. To identify the event type, set the
name attribute of the <code>probe</code> element to the type.</p>
</div>
<div class="paragraph">
<p>To define the characteristics of each event type, add the following
elements within the <code>probe</code> element:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>class</code></dt>
<dd>
<p>This element contains the fully qualified Java class name of the
component that generates the statistics for which you are defining
events.</p>
</dd>
<dt class="hdlist1"><code>method</code></dt>
<dd>
<p>This element contains the name of the method that is invoked to
generate the statistic.</p>
</dd>
<dt class="hdlist1"><code>signature</code></dt>
<dd>
<p>This element contains the following information about the signature if
the method:<br></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">return-type (paramater-type-list)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">return-type</dt>
<dd>
<p>The return type of the method.</p>
</dd>
<dt class="hdlist1">paramater-type-list</dt>
<dd>
<p>A comma-separated list of the types of the parameters in the method
signature.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>probe-param</code></dt>
<dd>
<p>The attributes of this element identify the type and the name of a
parameter in the method signature. One <code>probe-param</code> element is
required for each parameter in the method signature. The <code>probe-param</code>
element does not contain any data.<br>
The attributes of the <code>probe-param</code> element are as follows:<br></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>type</code></dt>
<dd>
<p>Specifies the type of the parameter.</p>
</dd>
<dt class="hdlist1"><code>name</code></dt>
<dd>
<p>Specifies the name of the parameter.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>return-param</code></dt>
<dd>
<p>The <code>type</code> attribute of this element specifies the return type of the
method. The <code>return-param</code> element does not contain any data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a id="GSACG00042"></a><a id="gkajj"></a></p>
</div>
<div class="paragraph">
<p>Example 5-2 Defining an Event Provider by Writing an XML Fragment</p>
</div>
<div class="paragraph">
<p>This example defines an event provider for the <code>glassfish:web:jsp</code>
component. The Java class of this component is
<code>com.sun.enterprise.web.jsp.JspProbeEmitterImpl</code>. The event provider
defines one event of type <code>jspLoadedEvent</code>. The signature of the method
that is associated with this event is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">void jspLoaded (String jsp, String hostName)

&lt;probe-provider moduleProviderName="glassfish" moduleName="web" probeProviderName="jsp"&gt;
    &lt;probe name="jspLoadedEvent"&gt;
       &lt;class&gt;com.sun.enterprise.web.jsp.JspProbeEmitterImpl&lt;/class&gt;
       &lt;method&gt;jspLoaded&lt;/method&gt;
       &lt;signature&gt;void (String,String)&lt;/signature&gt;
       &lt;probe-param type="String" name="jsp"/&gt;
       &lt;probe-param type="String" name="hostName"/&gt;
       &lt;return-param type="void" /&gt;
    &lt;/probe&gt;
&lt;/probe-provider&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="gkaie"></a><a id="GSACG00166"></a><a id="packaging-a-components-event-providers"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_packaging_a_component_s_event_providers">Packaging a Component&#8217;s Event Providers</h5>
<div class="paragraph">
<p>Packaging a component&#8217;s event providers enables the monitoring
infrastructure of GlassFish Server to discover the event providers
automatically.</p>
</div>
<div class="paragraph">
<p>To package a component&#8217;s event providers, add an entry to the
component&#8217;s <code>META-INF/MANIFEST.MF</code> file that identifies all of the
component&#8217;s event providers. The format of the entry depends on how the
event providers are defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the event providers are defined as Java classes, the entry is a
list of the event providers' class names as follows:<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>probe-provider-class-names : class-list</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>class-list</code> is a comma-separated list of the fully qualified Java
class names of the component&#8217;s event providers.
* If the event providers are defined as XML fragments, the entry is a
list of the paths to the files that contain the XML fragments as
follows:<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">probe-provider-xml-file-names : path-list</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>path-list</code> is a comma-separated list of the paths to the XML files
relative to the root of the archive in the JAR file.</p>
</div>
<div class="paragraph">
<p><a id="GSACG00043"></a><a id="gkaii"></a></p>
</div>
<div class="paragraph">
<p>Example 5-3 Manifest Entry for Event Providers That Are Defined as Java
Classes</p>
</div>
<div class="paragraph">
<p>This example shows the entry in the <code>META-INF/MANIFEST.MF</code> file of a
component whose event provider is the
<code>org.glassfish.pluggability.monitoring.ModuleProbeProvider</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">probe-provider-class-names : org.glassfish.pluggability.monitoring.ModuleProbeProvider</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghprg"></a><a id="GSACG00221"></a><a id="sending-an-event"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sending_an_event">Sending an Event</h4>
<div class="paragraph">
<p>At runtime, your add-on component might perform an operation that
generates statistics. To provide statistics about the operation to
GlassFish Server, your component must send an event of the correct type
when performing the operation.</p>
</div>
<div class="paragraph">
<p>To send an event, instantiate your event provider class and invoke the
method of the event provider class for the type of the event.
Instantiate the class and invoke the method in the class that represents
your add-on component. Ensure that the method is invoked when your
component performs the operation for which the event was defined. One
way to meet this requirement is to invoke the method for sending the
event in the body of the method for performing the operation.</p>
</div>
<div class="paragraph">
<p><a id="GSACG00044"></a><a id="ghpus"></a></p>
</div>
<div class="paragraph">
<p>Example 5-4 Sending an Event</p>
</div>
<div class="paragraph">
<p>This example shows the code for instantiating the <code>TxManager</code> class and
invoking the <code>onTxBegin</code> method to send an event of type <code>begin</code>. This
event indicates that a component is about to begin a transaction.</p>
</div>
<div class="paragraph">
<p>The <code>TxManager</code> class is instantiated in the constructor of the
<code>TransactionManagerImpl</code> class. To ensure that the event is sent at the
correct time, the <code>onTxBegin</code> method is invoked in the body of the
<code>begin</code> method, which starts a transaction.</p>
</div>
<div class="paragraph">
<p>The declaration of the <code>onTxBegin</code> method in the event provider
interface is shown in <a href="#ghprw">Example 5-1</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
public class TransactionManagerImpl {
...
     public TransactionManagerImpl() {
         TxManager txProvider = new TxManager();
         ...
     }
    ...
    public void begin() {
        String txId = createTransactionId();
        ....
        txProvider.onTxBegin(txId); //emit
      }
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghplw"></a><a id="GSACG00117"></a><a id="updating-the-monitorable-object-tree"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updating_the_monitorable_object_tree">Updating the Monitorable Object Tree</h3>
<div class="paragraph">
<p>A monitorable object is a component, subcomponent, or service that can
be monitored. GlassFish Server uses a tree structure to track
monitorable objects.</p>
</div>
<div class="paragraph">
<p>Because the tree is dynamic, the tree changes as components of the
GlassFish Server instance are added, modified, or removed. Objects are
also added to or removed from the tree in response to configuration
changes. For example, if monitoring for a component is turned off, the
component&#8217;s monitorable object is removed from the tree.</p>
</div>
<div class="paragraph">
<p>To enable system administrators to access statistics for all components
in the same way, you must provide statistics for an add-on component by
updating the monitorable object tree. Statistics for the add-on
component are then available through the GlassFish Server administrative
commands <a href="../reference-manual/get.html#GSRFM00139"><code>get</code></a>, o<a href="GSRFM00145"><code>list</code></a>, and
<a href="../reference-manual/set.html#GSRFM00226"><code>set</code></a>. These commands locate an object in the tree
through the object&#8217;s dotted name.</p>
</div>
<div class="paragraph">
<p>For more information about the tree structure of monitorable objects,
see "<a href="../administration-guide/monitoring.html#GSADG00727">How the Monitoring Tree Structure Works</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
<div class="paragraph">
<p>To make an add-on component a monitorable object, you must add the
add-on component to the monitorable object tree.</p>
</div>
<div class="paragraph">
<p>To update the statistics for an add-on component, you must add the
statistics to the monitorable object tree, and create event listeners to
gather statistics from events that represent these statistics. At
runtime, these listeners must update monitorable objects with statistics
that these events contain. The events are sent by event provider
classes. For information about how to create event provider classes and
send events, see <a href="#ghopc">Defining Statistics That Are to Be
Monitored</a>.</p>
</div>
<div class="paragraph">
<p>Updating the monitorable object tree involves the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ghpni">Creating Event Listeners</a></p>
</li>
<li>
<p><a href="#ghptp">Representing a Component&#8217;s Statistics in an Event Listener
Class</a></p>
</li>
<li>
<p><a href="#ghpml">Subscribing to Events From Event Provider Classes</a></p>
</li>
<li>
<p><a href="#ghppo">Registering an Event Listener</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="ghpni"></a><a id="GSACG00222"></a><a id="creating-event-listeners"></a></p>
</div>
<div class="sect3">
<h4 id="_creating_event_listeners">Creating Event Listeners</h4>
<div class="paragraph">
<p>An event listener gathers statistics from events that an event provider
sends. To enable an add-on component to gather statistics from events,
create listeners to receive events from the event provider. The listener
can receive events from the add-on component in which the listener is
created and from other components.</p>
</div>
<div class="paragraph">
<p>To create an event listener, write a Java class to represent the
listener. The listener can be any Java object.</p>
</div>
<div class="paragraph">
<p>An event listener also represents a component&#8217;s statistics. To enable
the Application Server Management Extensions (AMX) to expose the
statistics to client applications, annotate the declaration of the class
with the <code>org.glassfish.gmbal.ManagedObject</code> annotation.</p>
</div>
<div class="paragraph">
<p>Ensure that the class that you write meets these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The return value of all callback methods in the listener must be void.</p>
</li>
<li>
<p>Because the methods of your event provider class may be entered by
multiple threads, the listener must be thread safe. However,GlassFish
Server provides utility classes to perform some common operations such
as <code>count</code>, <code>avg</code>, and <code>sum</code>.</p>
</li>
<li>
<p>The listener must have the same restrictions as a Jakarta EE application. For example, the listener
cannot open server sockets, or create threads.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A listener is called in the same thread as the event method. As a
result, the listener can use thread locals. If the monitored system
allows access to thread locals, the listener can access thread locals of
the monitored system.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>A listener that is not registered to listen for events is never called
by the framework. Therefore, unregistered listeners do not consume any
computing resources, such as memory or processor cycles.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="ghptp"></a><a id="GSACG00223"></a><a id="representing-a-components-statistics-in-an-event-listener-class"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_representing_a_component_s_statistics_in_an_event_listener_class">Representing a Component&#8217;s Statistics in an Event Listener Class</h4>
<div class="paragraph">
<p>Represent each statistic as the property of a JavaBeans specification
getter method of your listener class. Methods in the listener class for
processing events can then access the property through the getter
method. For more information, see <a href="#ghpml">Subscribing to Events From
Event Provider Classes</a>.</p>
</div>
<div class="paragraph">
<p>To enable AMX to expose the statistic to client applications, annotate
the declaration of the getter method with the
<code>org.glassfish.gmbal.ManagedAttribute</code> annotation. Set the <code>id</code> element
of the <code>@ManagedAttribute</code> annotation to the property name all in
lowercase.</p>
</div>
<div class="paragraph">
<p>The data type of the property that represents a statistic must be a
class that provides methods for computing the statistic from event data.</p>
</div>
<div class="paragraph">
<p>The <code>org.glassfish.external.statistics.impl</code> package provides the
following classes to gather and compute statistics data:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>AverageRangeStatisticImpl</code></dt>
<dd>
<p>Provides standard measurements of the lowest and highest values that
an attribute has held and the current value of the attribute.</p>
</dd>
<dt class="hdlist1"><code>BoundaryStatisticImpl</code></dt>
<dd>
<p>Provides standard measurements of the upper and lower limits of the
value of an attribute.</p>
</dd>
<dt class="hdlist1"><code>BoundedRangeStatisticImpl</code></dt>
<dd>
<p>Aggregates the attributes of <code>RangeStatisticImpl</code> and
<code>BoundaryStatisticImpl</code> and provides standard measurements of a range
that has fixed limits.</p>
</dd>
<dt class="hdlist1"><code>CountStatisticImpl</code></dt>
<dd>
<p>Provides standard count measurements.</p>
</dd>
<dt class="hdlist1"><code>RangeStatisticImpl</code></dt>
<dd>
<p>Provides standard measurements of the lowest and highest values that
an attribute has held and the current value of the attribute.</p>
</dd>
<dt class="hdlist1"><code>StatisticImpl</code></dt>
<dd>
<p>Provides performance data.</p>
</dd>
<dt class="hdlist1"><code>StringStatisticImpl</code></dt>
<dd>
<p>Provides a string equivalent of a counter statistic.</p>
</dd>
<dt class="hdlist1"><code>TimeStatisticImpl</code></dt>
<dd>
<p>Provides standard timing measurements.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a id="GSACG00045"></a><a id="ghpsc"></a></p>
</div>
<div class="paragraph">
<p>Example 5-5 Representing a Component&#8217;s Statistics in an Event Listener
Class</p>
</div>
<div class="paragraph">
<p>This example shows the code for representing the <code>txcount</code> statistic in
the <code>TxListener</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.glassfish.external.statistics.CountStatistic;
import org.glassfish.external.statistics.impl.CountStatisticImpl;
...
import org.glassfish.gmbal.ManagedAttribute;
import org.glassfish.gmbal.ManagedObject;

...
@ManagedObject
public class TxListener {

    private CountStatisticImpl txCount = new CountStatisticImpl("TxCount",
        "count", "Number of completed transactions");
...
    @ManagedAttribute(id="txcount")
    public CountStatistic  getTxCount(){
         return txCount;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghpml"></a><a id="GSACG00224"></a><a id="subscribing-to-events-from-event-provider-classes"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="_subscribing_to_events_from_event_provider_classes">Subscribing to Events From Event Provider Classes</h4>
<div class="paragraph">
<p>To receive events from event provider classes, a listener must subscribe
to the events. Subscribing to events also specifies the provider and the
type of events that the listener will receive.</p>
</div>
<div class="paragraph">
<p>To subscribe to events from event provider classes, write one method in
your listener class to process each type of event. To specify the
provider and the type of event, annotate the method with the
<code>org.glassfish.external.probe.provider.annotations.ProbeListener</code>
annotation. In the <code>@ProbeListener</code> annotation, specify the provider and
the type as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">"module-providername:module-name:probe-provider-name:event-type"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">module-providername</dt>
<dd>
<p>The application to which the event provider belongs. This parameter
must be the value of the <code>moduleProviderName</code> element or attribute in
the definition of the event provider. See <a href="#ghovq">Defining an
Event Provider by Writing a Java Class</a> and <a href="#gkaec">Defining an
Event Provider by Writing an XML Fragment</a>.</p>
</dd>
<dt class="hdlist1">module-name</dt>
<dd>
<p>The module for which the event provider is defined. This parameter
must match be the value of the <code>moduleName</code> element or attribute in
the definition of the event provider. See <a href="#ghovq">Defining an
Event Provider by Writing a Java Class</a> and <a href="#gkaec">Defining an
Event Provider by Writing an XML Fragment</a>.</p>
</dd>
<dt class="hdlist1">probe-provider-name</dt>
<dd>
<p>The name of the event provider. This parameter must match be the value
of the <code>probeProviderName</code> element or attribute in the definition of
the event provider. See <a href="#ghovq">Defining an Event Provider by
Writing a Java Class</a> and <a href="#gkaec">Defining an Event Provider by
Writing an XML Fragment</a>.</p>
</dd>
<dt class="hdlist1">event-type</dt>
<dd>
<p>The type of the event. This type is defined in the event provider
class. For more information, see <a href="#ghosi">Defining Event Types in
an Event Provider Class</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Annotate each parameter in the method signature with the <code>@ProbeParam</code>
annotation. Set the <code>value</code> element of the <code>@ProbeParam</code> annotation to
the name of the parameter.</p>
</div>
<div class="paragraph">
<p>In the method body, provide the code to update monitoring statistics in
response to the event.</p>
</div>
<div class="paragraph">
<p><a id="GSACG00046"></a><a id="ghpwu"></a></p>
</div>
<div class="paragraph">
<p>Example 5-6 Subscribing to Events From Event Provider Classes</p>
</div>
<div class="paragraph">
<p>This example shows the code for subscribing to events of type <code>begin</code>
from the <code>tx</code> component. The provider of the component is <code>TxManager</code>.
The body of the <code>begin</code> method contains code to increase the transaction
count txcount by 1 each time that an event is received.</p>
</div>
<div class="paragraph">
<p>The definition of the <code>begin</code> event type is shown in <a href="#ghprw">Example
5-1</a>.</p>
</div>
<div class="paragraph">
<p>The code for sending <code>begin</code> events is shown in <a href="#ghpus">Example
5-4</a>.</p>
</div>
<div class="paragraph">
<p>The instantiation of the <code>txCount</code> object is shown in
<a href="#ghpsc">Example 5-5</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.glassfish.external.probe.provider.annotations.ProbeListener;
import org.glassfish.external.probe.provider.annotations.ProbeParam;
import org.glassfish.gmbal.ManagedObject;
...
@ManagedObject
public class TxListener {
    ...;    @ProbeListner("examplecomponent:transaction:manager:begin")
    public void begin(
    @ProbeParam("{txId}")
    String txId) {
      txCount.increment();
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghpsp"></a><a id="GSACG00167"></a><a id="listening-for-changes-to-values-that-are-not-part-of-the-target-method-definition"></a></p>
</div>
<div class="sect4">
<h5 id="_listening_for_changes_to_values_that_are_not_part_of_the_target_method_definition">Listening for Changes to Values That are Not Part of the Target Method Definition</h5>
<div class="paragraph">
<p>Event listeners can express their interest in certain predefined values
that are not part of the target method definition. For example,
$\{gf.appname}, $\{gf.modulename} etc. are some of the computed params
that are available to the clients, these values are computed/evaluated
only on demand and provided by the event infrastructure.</p>
</div>
<div class="paragraph">
<p><a id="ghpsw"></a><a id="GSACG00168"></a><a id="getting-information-about-a-event-provider"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_getting_information_about_a_event_provider">Getting Information About a Event Provider</h5>
<div class="paragraph">
<p><code>ProbeProviderInfo</code> contains details about individual event types in an
event provider class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public interface ProbeProviderInfo {

      public String getModuleName();

      public String getProviderName();

      public String getApplicationName();

      public String getProbeName();

      public String[] getParamterNames();

      public Class getParamterTypes();

 }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghpmt"></a><a id="GSACG00225"></a><a id="listening-for-events-from-classes-that-are-not-event-providers"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listening_for_events_from_classes_that_are_not_event_providers">Listening for Events From Classes That Are Not Event Providers</h4>
<div class="paragraph">
<p>gfProbes infrastructure allows clients to monitor glassfish even in the
absence of provider classes. This is done by allowing clients to receive
callbacks when a java methods are entered / exited. Note that while this
approach allows a client to monitor legacy code, it may not always be
possible to receive "high-level" events.</p>
</div>
<div class="paragraph">
<p>For example, while it is easy to monitor (through gfProbes) when
TransactionManagerImpl.begin() entered / exited, the client cannot
determine the transaction ID in this case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public class TxMonitor {
     @MethodEntry("tx:com.sun.tx.TxMgrImpl::onTxBegin")
     public void onTx(String tId) {
       count++;
     }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghpql"></a><a id="GSACG00169"></a><a id="monitoring-method-entry"></a></p>
</div>
<div class="sect4">
<h5 id="_monitoring_method_entry">Monitoring Method Entry</h5>
<div class="paragraph">
<p>The @MethodEntry annotation must be used by the client to receive
callback when the target method is entered. The client method argument
types and count must match the target methods parameter types/count.</p>
</div>
<div class="paragraph">
<p><a id="ghppg"></a><a id="GSACG00170"></a><a id="monitoring-method-exit"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_monitoring_method_exit">Monitoring Method Exit</h5>
<div class="paragraph">
<p>The @MethodExit annotation must be used by the client to receive
callback when the target method is exited. The client method argument
types and count must match the target methods parameter types/count. The
first parameter in the client method should match the return type of the
target method (only if the target method has a non void return type)</p>
</div>
<div class="paragraph">
<p><a id="ghplj"></a><a id="GSACG00171"></a><a id="monitoring-exceptions"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_monitoring_exceptions">Monitoring Exceptions</h5>
<div class="paragraph">
<p>The @OnException annotation must be used by the client to receive
callback when the target method exits because of an exception. The
client method argument types and count must match the target methods
parameter types/count. (This restriction might be removed later). The
first parameter in the client method should be of type Throwable</p>
</div>
<div class="paragraph">
<p><a id="ghppo"></a><a id="GSACG00226"></a><a id="registering-an-event-listener"></a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_registering_an_event_listener">Registering an Event Listener</h4>
<div class="paragraph">
<p>Registering an event listener enables the listener to receive callbacks
from the GlassFish Server event infrastructure. The listener can then
collect data from events and update monitorable objects in the object
tree. These monitorable objects form the basis for monitoring
statistics.</p>
</div>
<div class="paragraph">
<p>Registering an event listener also makes a component and its statistics
monitorable objects by adding statistics for the component to the
monitorable object tree.</p>
</div>
<div class="paragraph">
<p>At runtime, the GlassFish Server event infrastructure registers
listeners for an event provider when the event provider is started and
unregisters them when the event provider is shut down. As a result,
listeners have no dependencies on other components.</p>
</div>
<div class="paragraph">
<p>To register a listener, invoke the static
<code>org.glassfish.external.probe.provider.StatsProviderManager.register</code>
method in the class that represents your add-on component. In the method
invocation, pass the following information as parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the configuration element with which all statistics in the
event listener are to be associated. System administrators use this
element for enabling or disabling monitoring for the event listener.</p>
</li>
<li>
<p>The node in the monitorable object tree under which the event listener
is to be registered. To specify the node, pass one of the following
constants of the
<code>org.glassfish.external.probe.provider.PluginPointPluginPoint</code>
enumeration:</p>
<div class="ulist">
<ul>
<li>
<p>To register the listener under the <code>server/applications</code> node, pass
the <code>APPLICATIONS</code> constant.</p>
</li>
<li>
<p>To register the listener under the <code>server</code> node, pass the <code>SERVER</code>
constant.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The path through the monitorable object tree from the node under which
the event listener is registered down to the statistics in the event
listener. The nodes in this path are separated by the slash (<code>/</code>)
character.</p>
</li>
<li>
<p>The listener object that you are registering.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="GSACG00047"></a><a id="ghpuu"></a></p>
</div>
<div class="paragraph">
<p>Example 5-7 Registering an Event Listener</p>
</div>
<div class="paragraph">
<p>This example shows the code for registering the event listener
<code>TxListener</code> for the add-on component that is represented by the class
<code>TransactionManagerImpl</code>. The statistics that are defined in this
listener are associated with the <code>web-container</code> configuration element.
The listener is registered under the <code>server/applications</code> node. The
path from this node to the statistics in the event listener is
<code>tx/txapp</code>.</p>
</div>
<div class="paragraph">
<p>Code for the constructor of the <code>TxListener</code> class is beyond the scope
of this example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
import org.glassfish.external.probe.provider.StatsProviderManager;
import org.glassfish.external.probe.provider.PluginPoint
...
public class TransactionManagerImpl {
...
    StatsProviderManager.register("web-container", PluginPoint.APPLICATIONS,
        "tx/txapp", new TxListener());
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="ghrma"></a><a id="GSACG00118"></a><a id="dotted-names-and-rest-urls-for-an-add-on-components-statistics"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dotted_names_and_rest_urls_for_an_add_on_component_s_statistics">Dotted Names and REST URLs for an Add-On Component&#8217;s Statistics</h3>
<div class="paragraph">
<p>The GlassFish Server administrative subcommands <a href="../reference-manual/get.html#GSRFM00139"><code>get</code></a>,
<a href="../reference-manual/list.html#GSRFM00145"><code>list</code></a>, and o<a href="GSRFM00226"><code>set</code></a> locate a statistic
through the dotted name of the statistic. The dotted name of a statistic
for an add-on component is determined from the registration of the event
listener that defines the statistic as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">listener-parent-node.path-to-statistic.statistic-name</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">listener-parent-node</dt>
<dd>
<p>The node in the monitorable object tree under which the event listener
that defines the statistic is registered. This node is passed in the
invocation of the <code>register</code> method that registers the event listener.
For more information, see <a href="#ghppo">Registering an Event Listener</a>.</p>
</dd>
<dt class="hdlist1">path-to-statistic</dt>
<dd>
<p>The path through the monitorable object tree from the node under which
the event listener is registered down to the statistic in the event
listener in which each slash is replaced with a period. This path is
passed in the invocation of the <code>register</code> method that registers the
event listener. For more information, see <a href="#ghppo">Registering an
Event Listener</a>.</p>
</dd>
<dt class="hdlist1">statistic-name</dt>
<dd>
<p>The name of the statistic. This name is the value of the <code>id</code> element
of the <code>@ManagedAttribute</code> annotation on the property that represents
the statistic. For more information, see <a href="#ghptp">Representing a
Component&#8217;s Statistics in an Event Listener Class</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the dotted name of the <code>txcount</code> statistic that is defined
in <a href="#ghpsc">Example 5-5</a> and registered in <a href="#ghpuu">Example 5-7</a>
is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">server.applications.tx.txapp.txcount</code></pre>
</div>
</div>
<div class="paragraph">
<p>The formats of the URL to a REST resource that represents a statistic is
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">http://host:port/monitoring/domain/path</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">host</dt>
<dd>
<p>The host where the DAS is running.</p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>The HTTP port or HTTPS port for administration.</p>
</dd>
<dt class="hdlist1">path</dt>
<dd>
<p>The path to the statistic. The path is the dotted name of the
attribute in which each dot (<code>.</code>) is replaced with a slash (<code>/</code>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, the URL the REST resource for the <code>txcount</code> statistic that
is defined in <a href="#ghpsc">Example 5-5</a> and registered in
<a href="#ghpuu">Example 5-7</a> is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">http://localhost:4848/monitoring/domain/server/applications/tx/txapp/txcount</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the DAS is running on the local host and the HTTP port
for administration is 4848.</p>
</div>
<div class="paragraph">
<p><a id="ghmox"></a><a id="GSACG00119"></a><a id="adding-a-type-to-the-monitor-command"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_type_to_the_code_monitor_code_command">Adding a Type to the <code>monitor</code> Command</h3>
<div class="paragraph">
<p>To add a type to the <code>monitor</code> command, implement the <code>MonitorContract</code>
interface.</p>
</div>
<div class="paragraph">
<p>An implementation of the <code>MonitorContract</code> interface is an HK2 service
that provides monitoring data to the <code>monitor</code> command.</p>
</div>
<div class="paragraph">
<p><a id="ghptj"></a><a id="GSACG00120"></a><a id="example-of-adding-monitoring-capabilities"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_example_of_adding_monitoring_capabilities">Example of Adding Monitoring Capabilities</h3>
<div class="paragraph">
<p>This example shows a component that monitors the number of requests that
a container receives. The following table provides a cross-reference to
the listing of each class or interface in the example.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Listing</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModuleProbeProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ghpna">Example 5-8</a><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModuleBootStrap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ghpmu">Example 5-9</a><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModuleStatsTelemetry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ghpvw">Example 5-10</a><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Module</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ghpuc">Example 5-11</a><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModuleMBean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ghpwx">Example 5-12</a><br></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a id="GSACG00048"></a><a id="ghpna"></a></p>
</div>
<div class="paragraph">
<p>Example 5-8 Event Provider Class</p>
</div>
<div class="paragraph">
<p>This example illustrates how to define an event provider as explained in
<a href="#ghovq">Defining an Event Provider by Writing a Java Class</a>.</p>
</div>
<div class="paragraph">
<p>The example shows the definition of the <code>ModuleProbeProvider</code> class. The
event provider sends events when the request count is increased by 1 or
decreased by 1.</p>
</div>
<div class="paragraph">
<p>This class defines the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>moduleCountIncrementEvent</code></p>
</li>
<li>
<p><code>moduleCountDecrementEvent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The name of each method is also the name of the event type that is
associated with the method.</p>
</div>
<div class="paragraph">
<p>A parameter that is named <code>count</code> is passed to each method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.glassfish.pluggability.monitoring;

import org.glassfish.external.probe.provider.annotations.Probe;
import org.glassfish.external.probe.provider.annotations.ProbeParam;
import org.glassfish.external.probe.provider.annotations.ProbeProvider;

/**
 * Monitoring count events
 * Provider interface for module specific probe events.
 *
 */
@ProbeProvider(moduleProviderName = "glassfish", moduleName = "mybeanmodule",
probeProviderName = "mybean")
public class ModuleProbeProvider {

    /**
     * Emits probe event whenever the count is incremented
     */
    @Probe(name = "moduleCountIncrementEvent")
    public void moduleCountIncrementEvent(
            @ProbeParam("count") Integer count) {
    }

    /**
     * Emits probe event whenever the count is decremented
     */
    @Probe(name = "moduleCountDecrementEvent")
    public void moduleCountDecrementEvent(
            @ProbeParam("count") Integer count) {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00049"></a><a id="ghpmu"></a></p>
</div>
<div class="paragraph">
<p>Example 5-9 Bootstrap Class</p>
</div>
<div class="paragraph">
<p>This example illustrates how to register an event listener as explained
in <a href="#ghppo">Registering an Event Listener</a>. The example shows the
code for registering an instance of the listener class
<code>ModuleStatsTelemetry</code>. This instance is added as a child of the
<code>server/applications</code> node of the tree.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.glassfish.pluggability.monitoring;

import org.jvnet.hk2.component.PostConstruct;
import org.jvnet.hk2.annotations.Service;
import org.jvnet.hk2.annotations.Scoped;
import org.jvnet.hk2.component.Singleton;
import org.glassfish.external.probe.provider.StatsProviderManager;
import org.glassfish.external.probe.provider.PluginPoint;

/**
 * Monitoring Count Example
 * Bootstrap object for registering probe provider and listener
 *
 */
@Service
@Scoped(Singleton.class)
public class ModuleBootStrap implements PostConstruct {

    @Override
    public void postConstruct() {
        try {
            StatsProviderManager.register("web-container",
                    PluginPoint.APPLICATIONS, "myapp", new ModuleStatsTelemetry());
        } catch (Exception e) {
            System.out.println("Caught exception in postconstruct");
            e.printStackTrace();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00050"></a><a id="ghpvw"></a></p>
</div>
<div class="paragraph">
<p>Example 5-10 Listener Class</p>
</div>
<div class="paragraph">
<p>This example shows how to perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ghpni">Creating Event Listeners</a>. The example shows the code of
the <code>ModuleStatsTelemetry</code> listener class.</p>
</li>
<li>
<p><a href="#ghptp">Representing a Component&#8217;s Statistics in an Event Listener
Class</a>. The example shows the code for representing the
<code>countmbeancount</code> statistic.</p>
</li>
<li>
<p><a href="#ghpml">Subscribing to Events From Event Provider Classes</a>. The
example shows the code for subscribing to the following types of events
from the <code>count</code> component:</p>
<div class="ulist">
<ul>
<li>
<p><code>moduleCountIncrementEvent</code></p>
</li>
<li>
<p><code>moduleCountDecrementEvent</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.glassfish.pluggability.monitoring;

import org.glassfish.external.statistics.CountStatistic;
import org.glassfish.external.statistics.impl.CountStatisticImpl;
import org.glassfish.external.probe.provider.annotations.ProbeListener;
import org.glassfish.external.probe.provider.annotations.ProbeParam;
import org.glassfish.gmbal.ManagedAttribute;
import org.glassfish.gmbal.ManagedObject;

/**
 * Monitoring counter example
 * Telemtry object which listens to probe events and updates
 * the monitoring stats
 *
 */
@ManagedObject
public class ModuleStatsTelemetry {

    private CountStatisticImpl countMBeanCount = new CountStatisticImpl(
            "CountMBeanCount", "count", "Number of MBeans");

    @ManagedAttribute(id = "countmbeancount")
    public CountStatistic getCountMBeanCount() {
        return countMBeanCount;
    }

    @ProbeListener("count:example:countapp:moduleCountIncrementEvent")
    public void moduleCountIncrementEvent(
            @ProbeParam("count") Integer count) {
        countMBeanCount.increment();
    }

    @ProbeListener("count:example:countapp:moduleCountDecrementEvent")
    public void moduleCountDecrementEvent(
            @ProbeParam("count") Integer count) {
        countMBeanCount.decrement();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00051"></a><a id="ghpuc"></a></p>
</div>
<div class="paragraph">
<p>Example 5-11 MBean Interface</p>
</div>
<div class="paragraph">
<p>This example defines the interface for a simple standard MBean that has
methods to increase and decrease a counter by 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package com.example.count.monitoring;

/**
 * Monitoring counter example
 * ModuleMBean interface
 *
 */
public interface ModuleMBean {
    public Integer getCount() ;
    public void incrementCount() ;
    public void decrementCount() ;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSACG00052"></a><a id="ghpwx"></a></p>
</div>
<div class="paragraph">
<p>Example 5-12 MBean Implementation</p>
</div>
<div class="paragraph">
<p>This example illustrates how to send an event as explained in
<a href="#ghprg">Sending an Event</a>. The example shows code for sending events
as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>moduleCountIncrementEvent</code> method is invoked in the body of the
<code>incrementCount</code> method.</p>
</li>
<li>
<p>The <code>moduleCountDecrementEvent</code> method is invoked in the body of the
<code>decrementCount</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods <code>incrementCount</code> and <code>decrementCount</code> are invoked by an
entity that is beyond the scope of this example, for example, JConsole.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.glassfish.pluggability.monitoring;

/**
 * Monitoring counter example
 * ModuleMBean implementation
 *
 */
public class Module implements ModuleMBean {

    private int k = 0;
    private ModuleProbeProvider mpp = null;

    @Override
    public Integer getCount() {
        return k;
    }

    @Override
    public void incrementCount() {
        k++;
        if (mpp != null) {
            mpp.moduleCountIncrementEvent(k);
        }
    }

    @Override
    public void decrementCount() {
        k--;
        if (mpp != null) {
            mpp.moduleCountDecrementEvent(k);
        }
    }

    void setProbeProvider(ModuleProbeProvider mpp) {
        this.mpp = mpp;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>

<hr />

<table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>		
		<td align="left">
		<a href="extending-asadmin.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="adding-configuration-data.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>

<span id="copyright">
        <img src="img/eclipse_foundation_logo_tiny.png" height="20px" alt="Eclipse Foundation Logo" align="top"/>&nbsp;            
        <span >Copyright&nbsp;&copy;&nbsp;2020,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.</span>
</span>

<p align="center" class="beta">DRAFT</p>

</body>
</html>