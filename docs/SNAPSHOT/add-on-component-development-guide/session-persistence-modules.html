
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Creating a Session Persistence Module</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
<table id="doc-title" cellspacing="0" cellpadding="0">
  <tr>
  <td align="left" valign="top">
  <b>Creating a Session Persistence Module</b><br />
      <p class="beta">DRAFT</p>
  </td>
  </tr>
</table>
<hr />

<table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>
		<td align="left">
		<a href="adding-container-capabilities.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="packaging-integrating-delivering.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>


<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a id="GSACG00008"></a><a id="gkmhj"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-session-persistence-module">8 Creating a Session Persistence Module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GlassFish Server enables you to create a session persistence module in
the web container for high availability-related functionality by
implementing the <code>PersistenceStrategyBuilder</code> interface . Using the
<code>PersistenceStrategyBuilder</code> interface in an HK2 service makes the
session manager extensible because you can implement a new persistence
type without having to modify the web container code.</p>
</div>
<div class="paragraph">
<p>For information about other high-availability, session persistence
solutions, see "<a href="../ha-administration-guide/session-persistence-and-failover.html#GSHAG00011">Configuring High Availability Session
Persistence and Failover</a>" in GlassFish Server Open Source Edition High
Availability Administration Guide.</p>
</div>
<div class="paragraph">
<p><a id="gkmhr"></a><a id="GSACG00141"></a><a id="implementing-the-persistencestrategybuilder-interface"></a></p>
</div>
<div class="sect2">
<h3 id="_implementing_the_code_persistencestrategybuilder_code_interface">Implementing the <code>PersistenceStrategyBuilder</code> Interface</h3>
<div class="paragraph">
<p>You can implement the <code>PersistenceStrategyBuilder</code> interface by creating
a new web session manager type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package com.sun.enterprise.web;

import com.sun.enterprise.deployment.runtime.web.SessionManager;
import org.apache.catalina.Context;
import org.jvnet.hk2.annotations.Contract;

@Contract
public interface PersistenceStrategyBuilder {

    public void initializePersistenceStrategy(
            Context ctx,
            SessionManager smBean,
            ServerConfigLookup serverConfigLookup);

    public void setPersistenceFrequency(String persistenceFrequency);

    public void setPersistenceScope(String persistenceScope);

    public void setPassedInPersistenceType(String persistenceType);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of how to implement the <code>PersistenceStrategyBuilder</code>
interface by creating a new web session manager and setting a store for
it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Service(name="xyz")
public class XYZStrategyBuilder implements PersistenceStrategyBuilder {

    private String persistenceFrequency = null;
    private String persistenceScope = null;
    private String persistenceType = null;

    public void init(StandardContext ctx, SessionManager sessionManager,
      ServerConfigLookup serverConfigLookup) {
        // add listeners, valves, etc. to the ctx
        // Set the manager and store
    }

    public void setPersistenceFrequency(String persistenceFrequency) {
        this.persistenceFrequency = persistenceFrequency;
    }

    public void setPersistenceScope(String persistenceScope) {
        this.persistenceScope = persistenceScope;
    }

    public void setPassedInPersistenceType(String persistenceType) {
        this.passedInPersistenceType = persistenceType;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a <code>Manager</code> is provided, then it will be used in GlassFish Server.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Note:</p>
</div>
<div class="paragraph">
<p>If a backing store is required, it is the responsibility of the
<code>Manager</code> to make sure that the <code>findSession</code> method correctly uses the
<code>Store</code> that the <code>Manager</code> provides.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="sthref10" class="paragraph">
<p>Example 8-1 Implementing <code>PersistenceStrategyBuilder</code> With a Custom Web
Session Manager</p>
</div>
<div class="paragraph">
<p>This example defines a session manager type that is named
<code>MyHASolution</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Service(name="MyHASolution")
public class MyHASolutionStrategyBuilder implements PersistenceStrategyBuilder {

    private String persistenceFrequency = null;
    private String persistenceScope = null;
    private String persistenceType = null;

    public void init(StandardContext ctx, SessionManager sessionManager,
      ServerConfigLookup serverConfigLookup) {
        // add listeners, valves, etc. to the ctx
        // Set the manager and store
        MyManager myManager = new MyManager(persistenceType, persistenceFrequency);
        // (You could also make this a service and look it up in the habitat.
        // For simplicity we are just doing a new implementation of the class here.)
        MyStore store = new MyStore();
        myManager.setStore(store);
        ctx.setManager(myManager);
    }

    public void setPersistenceFrequency(String persistenceFrequency) {
        this.persistenceFrequency = persistenceFrequency;
    }

    public void setPersistenceScope(String persistenceScope) {
        this.persistenceScope = persistenceScope;
    }

    public void setPassedInPersistenceType(String persistenceType) {
        this.passedInPersistenceType = persistenceType;

    }

}</code></pre>
</div>
</div>
<div id="sthref11" class="paragraph">
<p>Example 8-2 Session Manager Configuration in the <code>glassfish-web.xml</code>
File</p>
</div>
<div class="paragraph">
<p>This example sets the <code>persistence-type</code> attribute of the
<code>session-manager</code> element of <code>glassfish-web.xml</code> to <code>myHASolution</code></p>
</div>
<div class="paragraph">
<p>Based on the <code>domain.xml</code> and <code>glassfish-web.xml</code> settings, the web
container looks up the appropriate <code>PersistenceStrategyBuilder</code>
interface in the Habitat and uses it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">       &lt;glassfish-web-app&gt;
         &lt;session-config&gt;
           &lt;session-manager persistence-type="myHASolution"/&gt;
         &lt;session-config&gt;
       &lt;glassfish-web-app&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>

<hr />

<table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
	<colgroup>
		<col width="12%"/>
		<col width="12%"/>
		<col width="*"/>
	</colgroup>
	<tr>		
		<td align="left">
		<a href="adding-container-capabilities.html">
			<span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Previous</span>
		</a>
		</td>

		<td align="left">
		<a href="packaging-integrating-delivering.html">
			<span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Next</span>
		</a>
		</td>

		<td align="right">
		<a href="toc.html">
			<span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
			<span style="position:relative;top:-2px;">Contents</span>
		</a>
		</td>
	</tr>
</table>

<span id="copyright">
        <img src="img/eclipse_foundation_logo_tiny.png" height="20px" alt="Eclipse Foundation Logo" align="top"/>&nbsp;            
        <span >Copyright&nbsp;&copy;&nbsp;2020,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.</span>
</span>

<p align="center" class="beta">DRAFT</p>

</body>
</html>